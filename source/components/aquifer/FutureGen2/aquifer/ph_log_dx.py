'''
output: ph_log_dx
prediction score: 0.9128399441500015
Forward Pass
---------------------------------------------------------------
iter  parent  var  knot  mse       terms  gcv    rsq    grsq
---------------------------------------------------------------
0     -       -    -     8.958492  1      8.962  0.000  0.000
1     0       9    878   1.585703  3      1.590  0.823  0.823
2     2       10   3303  1.415082  5      1.421  0.842  0.841
3     0       2    3729  1.373039  7      1.382  0.847  0.846
4     6       10   2985  1.336076  9      1.347  0.851  0.850
5     6       10   1590  1.295406  11     1.309  0.855  0.854
6     1       10   585   1.253122  13     1.269  0.860  0.858
7     0       3    -1    1.216338  14     1.233  0.864  0.862
8     1       10   4808  1.185164  16     1.204  0.868  0.866
9     1       1    -1    1.153553  17     1.173  0.871  0.869
10    0       4    -1    1.130017  18     1.150  0.874  0.872
11    17      10   1554  1.095849  20     1.117  0.878  0.875
12    2       10   3386  1.063404  22     1.087  0.881  0.879
13    0       10   1502  1.028389  24     1.053  0.885  0.883
14    22      6    -1    0.972614  25     0.997  0.891  0.889
15    23      9    1950  0.938095  27     0.963  0.895  0.893
16    0       10   4146  0.906421  29     0.933  0.899  0.896
17    28      9    148   0.871423  31     0.899  0.903  0.900
18    22      0    1584  0.839572  33     0.867  0.906  0.903
19    2       10   1696  0.821418  35     0.850  0.908  0.905
20    27      6    -1    0.798416  36     0.827  0.911  0.908
21    13      10   4032  0.782842  38     0.813  0.913  0.909
22    17      9    1137  0.768268  40     0.799  0.914  0.911
23    23      9    3066  0.755057  42     0.787  0.916  0.912
24    28      8    -1    0.742918  43     0.775  0.917  0.913
25    1       9    4084  0.731494  45     0.765  0.918  0.915
26    17      10   4455  0.722076  47     0.757  0.919  0.916
27    13      9    2316  0.714524  49     0.750  0.920  0.916
---------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
----------------------------------------------
iter  bf  terms  mse   gcv    rsq     grsq
----------------------------------------------
0     -   49     0.72  0.751  0.920   0.916
1     12  48     0.72  0.750  0.920   0.916
2     2   47     0.72  0.750  0.920   0.916
3     10  46     0.72  0.749  0.920   0.916
4     20  45     0.72  0.748  0.920   0.917
5     46  44     0.72  0.747  0.920   0.917
6     23  43     0.72  0.747  0.920   0.917
7     19  42     0.72  0.746  0.920   0.917
8     22  41     0.72  0.745  0.920   0.917
9     47  40     0.72  0.745  0.920   0.917
10    41  39     0.72  0.744  0.920   0.917
11    37  38     0.72  0.744  0.920   0.917
12    30  37     0.72  0.744  0.920   0.917
13    5   36     0.72  0.745  0.920   0.917
14    31  35     0.72  0.746  0.920   0.917
15    8   34     0.72  0.747  0.919   0.917
16    38  33     0.73  0.750  0.919   0.916
17    39  32     0.73  0.754  0.918   0.916
18    43  31     0.74  0.759  0.918   0.915
19    11  30     0.74  0.764  0.917   0.915
20    44  29     0.75  0.776  0.916   0.913
21    24  28     0.76  0.783  0.915   0.913
22    45  27     0.77  0.795  0.914   0.911
23    17  26     0.78  0.804  0.913   0.910
24    16  25     0.80  0.818  0.911   0.909
25    42  24     0.81  0.831  0.909   0.907
26    14  23     0.83  0.846  0.908   0.906
27    32  22     0.84  0.860  0.906   0.904
28    40  21     0.86  0.881  0.904   0.902
29    25  20     0.88  0.900  0.901   0.900
30    28  19     0.89  0.910  0.900   0.898
31    26  18     0.91  0.922  0.899   0.897
32    9   17     0.93  0.941  0.897   0.895
33    48  16     0.94  0.959  0.895   0.893
34    36  15     0.96  0.977  0.893   0.891
35    4   14     0.98  0.997  0.890   0.889
36    6   13     1.01  1.020  0.888   0.886
37    13  12     1.03  1.045  0.885   0.883
38    18  11     1.08  1.088  0.880   0.879
39    7   10     1.15  1.161  0.872   0.870
40    35  9      1.22  1.231  0.864   0.863
41    29  8      1.33  1.335  0.852   0.851
42    15  7      1.35  1.362  0.849   0.848
43    27  6      1.36  1.371  0.848   0.847
44    33  5      1.42  1.427  0.841   0.841
45    21  4      1.42  1.428  0.841   0.841
46    34  3      2.13  2.136  0.762   0.762
47    3   2      2.67  2.673  0.702   0.702
48    1   1      8.96  8.962  -0.000  -0.000
----------------------------------------------
Selected iteration: 12

Earth Model
------------------------------------------------------------------------
Basis Function                                     Pruned  Coefficient
------------------------------------------------------------------------
(Intercept)                                        No      9.75181
h(log_co2_mass-9.97936)                            No      0.783543
h(9.97936-log_co2_mass)                            Yes     None
h(log_brine_mass-1.90082)*h(9.97936-log_co2_mass)  No      -0.216447
h(1.90082-log_brine_mass)*h(9.97936-log_co2_mass)  No      0.243185
h(por-0.199086)                                    No      -1271.1
h(0.199086-por)                                    No      8.45185
h(log_brine_mass-23.1147)*h(0.199086-por)          No      41.8163
h(23.1147-log_brine_mass)*h(0.199086-por)          No      -0.196733
h(log_brine_mass-14.3794)*h(0.199086-por)          No      -2.0335
h(14.3794-log_brine_mass)*h(0.199086-por)          Yes     None
h(log_brine_mass-12.3743)*h(log_co2_mass-9.97936)  No      0.0342438
h(12.3743-log_brine_mass)*h(log_co2_mass-9.97936)  Yes     None
log_permh                                          No      0.313749
h(log_brine_mass-22.9399)*h(log_co2_mass-9.97936)  No      -0.191494
h(22.9399-log_brine_mass)*h(log_co2_mass-9.97936)  No      -0.140034
depth*h(log_co2_mass-9.97936)                      No      0.000174187
log_aniso                                          No      -0.324472
h(log_brine_mass-23.3501)*log_aniso                No      -1.39728
h(23.3501-log_brine_mass)*log_aniso                Yes     None
h(log_brine_mass-17.2346)*h(9.97936-log_co2_mass)  Yes     None
h(17.2346-log_brine_mass)*h(9.97936-log_co2_mass)  No      0.274588
h(log_brine_mass-14.363)                           Yes     None
h(14.363-log_brine_mass)                           Yes     None
log_co2_rate*h(log_brine_mass-14.363)              No      0.277869
h(log_co2_mass-2.16874)*h(14.363-log_brine_mass)   No      0.0726056
h(2.16874-log_co2_mass)*h(14.363-log_brine_mass)   No      -0.137001
h(log_brine_mass-16.9454)                          No      -2.06067
h(16.9454-log_brine_mass)                          No      -0.601079
h(log_co2_mass-11.116)*h(16.9454-log_brine_mass)   No      0.314739
h(11.116-log_co2_mass)*h(16.9454-log_brine_mass)   Yes     None
h(thick-89.8134)*h(log_brine_mass-14.363)          No      -1.10355
h(89.8134-thick)*h(log_brine_mass-14.363)          No      0.00286177
h(log_brine_mass-11.5573)*h(9.97936-log_co2_mass)  No      0.371012
h(11.5573-log_brine_mass)*h(9.97936-log_co2_mass)  No      -0.410086
log_co2_rate*h(log_brine_mass-16.9454)             No      -0.756015
h(log_brine_mass-16.992)*log_permh                 No      -0.0810098
h(16.992-log_brine_mass)*log_permh                 Yes     None
h(log_co2_mass-6.85459)*log_aniso                  No      0.013989
h(6.85459-log_co2_mass)*log_aniso                  No      0.0459094
h(log_co2_mass-11.3706)*h(14.363-log_brine_mass)   No      -0.236843
h(11.3706-log_co2_mass)*h(14.363-log_brine_mass)   Yes     None
time*h(16.9454-log_brine_mass)                     No      0.000687807
h(log_co2_mass-22.1957)*h(log_co2_mass-9.97936)    No      0.029246
h(22.1957-log_co2_mass)*h(log_co2_mass-9.97936)    No      0.0132954
h(log_brine_mass-17.8042)*log_aniso                No      0.100132
h(17.8042-log_brine_mass)*log_aniso                Yes     None
h(log_co2_mass-9.32281)*log_permh                  Yes     None
h(9.32281-log_co2_mass)*log_permh                  No      -0.0320618
------------------------------------------------------------------------
MSE: 0.7169, GCV: 0.7438, RSQ: 0.9200, GRSQ: 0.9170
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: 9.751814866765518,
        lambda x: 0.7835430507227336 * max(0, x[9] - 9.979355888729513),
        lambda x: -0.21644748513036144 * max(0, x[10] - 1.9008169809906073) *\
            max(0, 9.979355888729513 - x[9]),
        lambda x: 0.24318461048642587 * max(0, 1.9008169809906073 - x[10]) *\
            max(0, 9.979355888729513 - x[9]),
        lambda x: -1271.0990024221542 * max(0, x[2] - 0.19908597940829562),
        lambda x: 8.451851097376272 * max(0, 0.19908597940829562 - x[2]),
        lambda x: 41.81633659865939 * max(0, x[10] - 23.114681123944898) *\
            max(0, 0.19908597940829562 - x[2]),
        lambda x: -0.19673325645596687 * max(0, 23.114681123944898 - x[10]) *\
            max(0, 0.19908597940829562 - x[2]),
        lambda x: -2.033503398400357 * max(0, x[10] - 14.379418723581274) *\
            max(0, 0.19908597940829562 - x[2]),
        lambda x: 0.03424376633058551 * max(0, x[10] - 12.374329557918076) *\
            max(0, x[9] - 9.979355888729513),
        lambda x: 0.31374902857618403 * x[3],
        lambda x: -0.19149444411008135 * max(0, x[10] - 22.939857078087172) *\
            max(0, x[9] - 9.979355888729513),
        lambda x: -0.1400342417208142 * max(0, 22.939857078087172 - x[10]) *\
            max(0, x[9] - 9.979355888729513),
        lambda x: 0.00017418674709901438 * x[1] * max(0, x[9] - 9.979355888729513),
        lambda x: -0.32447209802975313 * x[4],
        lambda x: -1.3972797860278967 * max(0, x[10] - 23.350089684384745) * x[4],
        lambda x: 0.27458810674505146 * max(0, 17.234563417418823 - x[10]) *\
            max(0, 9.979355888729513 - x[9]),
        lambda x: 0.27786875608779554 * x[6] * max(0, x[10] - 14.363037497810842),
        lambda x: 0.07260560635888677 * max(0, x[9] - 2.1687375270750056) *\
            max(0, 14.363037497810842 - x[10]),
        lambda x: -0.1370011484939271 * max(0, 2.1687375270750056 - x[9]) *\
            max(0, 14.363037497810842 - x[10]),
        lambda x: -2.060673098527719 * max(0, x[10] - 16.945375271642703),
        lambda x: -0.6010793238237061 * max(0, 16.945375271642703 - x[10]),
        lambda x: 0.31473899814973727 * max(0, x[9] - 11.11601375315877) *\
            max(0, 16.945375271642703 - x[10]),
        lambda x: -1.1035527683659014 * max(0, x[0] - 89.81338811409051) *\
            max(0, x[10] - 14.363037497810842),
        lambda x: 0.002861773512436043 * max(0, 89.81338811409051 - x[0]) *\
            max(0, x[10] - 14.363037497810842),
        lambda x: 0.37101218438401157 * max(0, x[10] - 11.557255573059148) *\
            max(0, 9.979355888729513 - x[9]),
        lambda x: -0.4100858452699213 * max(0, 11.557255573059148 - x[10]) *\
            max(0, 9.979355888729513 - x[9]),
        lambda x: -0.7560146391249284 * x[6] * max(0, x[10] - 16.945375271642703),
        lambda x: -0.0810098312234939 * max(0, x[10] - 16.992049351511014) * x[3],
        lambda x: 0.013988968327839434 * max(0, x[9] - 6.854588530730017) * x[4],
        lambda x: 0.04590937417562048 * max(0, 6.854588530730017 - x[9]) * x[4],
        lambda x: -0.2368428904285174 * max(0, x[9] - 11.370635189586997) *\
            max(0, 14.363037497810842 - x[10]),
        lambda x: 0.0006878067144375638 * x[8] * max(0, 16.945375271642703 - x[10]),
        lambda x: 0.029245980237209562 * max(0, x[9] - 22.195725950924906) *\
            max(0, x[9] - 9.979355888729513),
        lambda x: 0.013295358022767895 * max(0, 22.195725950924906 - x[9]) *\
            max(0, x[9] - 9.979355888729513),
        lambda x: 0.10013223575361993 * max(0, x[10] - 17.804217718641333) * x[4],
        lambda x: -0.03206181530690218 * max(0, 9.322811252218186 - x[9]) * x[3]]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
