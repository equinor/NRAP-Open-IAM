'''
output: tds_log_dy
prediction score: 0.9670687612442669
Forward Pass
---------------------------------------------------------------
iter  parent  var  knot  mse       terms  gcv    rsq    grsq
---------------------------------------------------------------
0     -       -    -     7.187197  1      7.190  0.000  0.000
1     0       10   4101  0.647503  3      0.649  0.910  0.910
2     0       9    4226  0.519419  5      0.522  0.928  0.927
3     3       10   -1    0.394606  6      0.397  0.945  0.945
4     0       2    -1    0.333009  7      0.335  0.954  0.953
5     1       3    3737  0.306432  9      0.309  0.957  0.957
6     6       10   4159  0.291669  11     0.295  0.959  0.959
7     4       10   505   0.278426  13     0.282  0.961  0.961
8     1       0    -1    0.267552  14     0.271  0.963  0.962
9     1       4    -1    0.259338  15     0.263  0.964  0.963
10    3       7    -1    0.251595  16     0.256  0.965  0.964
11    1       8    -1    0.243304  17     0.247  0.966  0.966
12    1       9    1494  0.236018  19     0.240  0.967  0.967
13    0       1    -1    0.229764  20     0.234  0.968  0.967
---------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
--------------------------------------------
iter  bf  terms  mse   gcv    rsq    grsq
--------------------------------------------
0     -   20     0.23  0.234  0.968  0.967
1     9   19     0.23  0.234  0.968  0.967
2     4   18     0.23  0.234  0.968  0.967
3     17  17     0.23  0.234  0.968  0.967
4     12  16     0.23  0.235  0.968  0.967
5     7   15     0.24  0.240  0.967  0.967
6     19  14     0.24  0.246  0.966  0.966
7     14  13     0.25  0.254  0.965  0.965
8     16  12     0.26  0.262  0.964  0.964
9     15  11     0.27  0.272  0.963  0.962
10    2   10     0.28  0.283  0.961  0.961
11    10  9      0.28  0.285  0.961  0.960
12    13  8      0.29  0.297  0.959  0.959
13    18  7      0.32  0.318  0.956  0.956
14    11  6      0.32  0.320  0.956  0.956
15    8   5      0.34  0.341  0.953  0.953
16    6   4      0.40  0.403  0.944  0.944
17    5   3      0.53  0.532  0.926  0.926
18    3   2      0.66  0.665  0.908  0.908
19    1   1      7.19  7.190  0.000  0.000
--------------------------------------------
Selected iteration: 2

Earth Model
-------------------------------------------------------------------------
Basis Function                                     Pruned  Coefficient
-------------------------------------------------------------------------
(Intercept)                                        No      0.988825
h(log_brine_mass-5.25677)                          No      0.468847
h(5.25677-log_brine_mass)                          No      -0.131195
h(log_co2_mass-15.2384)                            No      0.496976
h(15.2384-log_co2_mass)                            Yes     None
log_brine_mass*h(log_co2_mass-15.2384)             No      -0.0253262
por                                                No      -5.55923
h(log_permh+11.018)*h(log_brine_mass-5.25677)      No      -46.1737
h(-11.018-log_permh)*h(log_brine_mass-5.25677)     No      -0.0256592
h(log_brine_mass-5.58063)*por                      Yes     None
h(5.58063-log_brine_mass)*por                      No      1.09109
h(log_brine_mass-9.17598)*h(15.2384-log_co2_mass)  No      -0.0144498
h(9.17598-log_brine_mass)*h(15.2384-log_co2_mass)  No      -0.00160791
thick*h(log_brine_mass-5.25677)                    No      -0.000596206
log_aniso*h(log_brine_mass-5.25677)                No      -0.0115122
log_brine_rate*h(log_co2_mass-15.2384)             No      0.0630282
time*h(log_brine_mass-5.25677)                     No      0.000444982
h(log_co2_mass-19.3144)*h(log_brine_mass-5.25677)  No      0.00612045
h(19.3144-log_co2_mass)*h(log_brine_mass-5.25677)  No      0.00999593
depth                                              No      0.000462938
-------------------------------------------------------------------------
MSE: 0.2298, GCV: 0.2339, RSQ: 0.9680, GRSQ: 0.9675
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: 0.9888250674912472,
        lambda x: 0.4688469154535836 * max(0, x[10] - 5.2567713302600945),
        lambda x: -0.13119518821765613 * max(0, 5.2567713302600945 - x[10]),
        lambda x: 0.4969763503747348 * max(0, x[9] - 15.238447548768502),
        lambda x: -0.025326230479193947 * x[10] * max(0, x[9] - 15.238447548768502),
        lambda x: -5.559233844274054 * x[2],
        lambda x: -46.17373937013017 * max(0, x[3] - -11.017956539011895) *\
             max(0, x[10] - 5.2567713302600945),
        lambda x: -0.025659206958314567 * max(0, -11.017956539011895 - x[3]) *\
            max(0, x[10] - 5.2567713302600945),
        lambda x: 1.091086690442576 * max(0, 5.580630816103985 - x[10]) * x[2],
        lambda x: -0.014449755960271614 * max(0, x[10] - 9.17598409133641) *\
             max(0, 15.238447548768502 - x[9]),
        lambda x: -0.00160790818699625 * max(0, 9.17598409133641 - x[10]) *\
             max(0, 15.238447548768502 - x[9]),
        lambda x: -0.000596206020531731 * x[0] * max(0, x[10] - 5.2567713302600945),
        lambda x: -0.011512211416914796 * x[4] * max(0, x[10] - 5.2567713302600945),
        lambda x: 0.06302817260249545 * x[7] * max(0, x[9] - 15.238447548768502),
        lambda x: 0.00044498209691901103 * x[8] * max(0, x[10] - 5.2567713302600945),
        lambda x: 0.006120452574658026 * max(0, x[9] - 19.314352126678695) *\
             max(0, x[10] - 5.2567713302600945),
        lambda x: 0.009995927326473218 * max(0, 19.314352126678695 - x[9]) *\
             max(0, x[10] - 5.2567713302600945),
        lambda x: 0.0004629379322882987 * x[1]]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
