'''
output: pres_log_dx
prediction score: 0.9212758622233588
Forward Pass
-----------------------------------------------------------------
iter  parent  var  knot  mse        terms  gcv     rsq    grsq
-----------------------------------------------------------------
0     -       -    -     28.068281  1      28.080  0.000  0.000
1     0       10   3543  15.651089  3      15.689  0.442  0.441
2     0       9    1877  7.367327   5      7.400   0.738  0.736
3     3       10   26    4.609146   7      4.639   0.836  0.835
4     0       3    -1    4.091608   8      4.122   0.854  0.853
5     3       9    794   3.745591   10     3.781   0.867  0.865
6     2       9    99    3.500127   12     3.540   0.875  0.874
7     7       10   4049  3.164478   14     3.207   0.887  0.886
8     0       1    -1    2.983873   15     3.027   0.894  0.892
9     0       8    -1    2.801613   16     2.845   0.900  0.899
10    15      10   2593  2.627021   18     2.673   0.906  0.905
11    7       10   3543  2.521513   20     2.571   0.910  0.908
12    14      10   4146  2.432530   22     2.485   0.913  0.911
13    7       0    -1    2.355307   23     2.409   0.916  0.914
14    7       9    3116  2.281725   25     2.338   0.919  0.917
15    14      9    1761  2.216966   27     2.277   0.921  0.919
16    15      9    732   2.158749   29     2.221   0.923  0.921
17    15      8    -1    2.122784   30     2.187   0.924  0.922
18    15      9    2766  2.098591   32     2.166   0.925  0.923
-----------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
----------------------------------------------
iter  bf  terms  mse    gcv     rsq    grsq
----------------------------------------------
0     -   32     2.10   2.166   0.925  0.923
1     28  31     2.10   2.164   0.925  0.923
2     7   30     2.10   2.162   0.925  0.923
3     11  29     2.10   2.160   0.925  0.923
4     3   28     2.10   2.158   0.925  0.923
5     5   27     2.12   2.181   0.924  0.922
6     30  26     2.16   2.214   0.923  0.921
7     8   25     2.19   2.239   0.922  0.920
8     29  24     2.22   2.272   0.921  0.919
9     31  23     2.26   2.310   0.920  0.918
10    27  22     2.29   2.342   0.918  0.917
11    21  21     2.34   2.388   0.917  0.915
12    20  20     2.38   2.428   0.915  0.914
13    22  19     2.44   2.482   0.913  0.912
14    25  18     2.51   2.550   0.911  0.909
15    26  17     2.55   2.589   0.909  0.908
16    17  16     2.66   2.699   0.905  0.904
17    16  15     2.72   2.759   0.903  0.902
18    4   14     2.81   2.851   0.900  0.898
19    23  13     2.89   2.922   0.897  0.896
20    24  12     2.93   2.967   0.896  0.894
21    18  11     3.05   3.085   0.891  0.890
22    9   10     3.18   3.209   0.887  0.886
23    14  9      3.37   3.400   0.880  0.879
24    2   8      3.56   3.584   0.873  0.872
25    15  7      3.76   3.780   0.866  0.865
26    19  6      4.14   4.167   0.852  0.852
27    13  5      4.15   4.168   0.852  0.852
28    12  4      4.74   4.755   0.831  0.831
29    10  3      6.45   6.467   0.770  0.770
30    6   2      15.79  15.810  0.438  0.437
31    1   1      28.07  28.080  0.000  0.000
----------------------------------------------
Selected iteration: 4

Earth Model
-------------------------------------------------------------------------
Basis Function                                     Pruned  Coefficient
-------------------------------------------------------------------------
(Intercept)                                        No      -17.6958
h(log_brine_mass-14.0361)                          No      2.485
h(14.0361-log_brine_mass)                          No      1.20297
h(log_co2_mass-11.3488)                            Yes     None
h(11.3488-log_co2_mass)                            No      0.254456
h(log_brine_mass-20.0239)*h(log_co2_mass-11.3488)  No      -0.0542686
h(20.0239-log_brine_mass)*h(log_co2_mass-11.3488)  No      0.164498
log_permh                                          Yes     None
h(log_co2_mass-19.1308)*h(log_co2_mass-11.3488)    No      0.292511
h(19.1308-log_co2_mass)*h(log_co2_mass-11.3488)    No      -0.0692351
h(log_co2_mass-11.9447)*h(14.0361-log_brine_mass)  No      -0.175622
h(11.9447-log_co2_mass)*h(14.0361-log_brine_mass)  Yes     None
h(log_brine_mass-20.884)*log_permh                 No      0.485821
h(20.884-log_brine_mass)*log_permh                 No      -0.301266
depth                                              No      0.00777347
time                                               No      -0.109765
h(log_brine_mass-17.5496)*time                     No      0.00927694
h(17.5496-log_brine_mass)*time                     No      0.00249303
h(log_brine_mass-14.0361)*log_permh                No      -0.222111
h(14.0361-log_brine_mass)*log_permh                No      0.413501
h(log_brine_mass-16.9454)*depth                    No      -0.00085784
h(16.9454-log_brine_mass)*depth                    No      -0.000235921
thick*log_permh                                    No      0.00112743
h(log_co2_mass-19.4273)*log_permh                  No      0.382526
h(19.4273-log_co2_mass)*log_permh                  No      0.0321485
h(log_co2_mass-19.2234)*depth                      No      -0.00126968
h(19.2234-log_co2_mass)*depth                      No      -0.000244907
h(log_co2_mass-16.7687)*time                       No      0.0143194
h(16.7687-log_co2_mass)*time                       Yes     None
time*time                                          No      0.000515669
h(log_co2_mass-21.0218)*time                       No      -0.0253476
h(21.0218-log_co2_mass)*time                       No      0.00215528
-------------------------------------------------------------------------
MSE: 2.0994, GCV: 2.1582, RSQ: 0.9252, GRSQ: 0.9231
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: -17.695759476794763,
        lambda x: 2.4850005185600064 * max(0, x[10] - 14.036059887032016),
        lambda x: 1.202973309885977 * max(0, 14.036059887032016 - x[10]),
        lambda x: 0.2544558942638507 * max(0, 11.348827411262436 - x[9]),
        lambda x: -0.05426864710750383 * max(0, x[10] - 20.02387702704444) *\
            max(0, x[9] - 11.348827411262436),
        lambda x: 0.16449788374226265 * max(0, 20.02387702704444 - x[10]) *\
            max(0, x[9] - 11.348827411262436),
        lambda x: 0.29251069845923416 * max(0, x[9] - 19.13077073142165) *\
            max(0, x[9] - 11.348827411262436),
        lambda x: -0.0692350773144284 * max(0, 19.13077073142165 - x[9]) *\
            max(0, x[9] - 11.348827411262436),
        lambda x: -0.1756223305251157 * max(0, x[9] - 11.944722219893636) *\
            max(0, 14.036059887032016 - x[10]),
        lambda x: 0.48582147269062226 * max(0, x[10] - 20.88402251064488) * x[3],
        lambda x: -0.30126556311083175 * max(0, 20.88402251064488 - x[10]) * x[3],
        lambda x: 0.0077734728693067134 * x[1],
        lambda x: -0.10976494465094402 * x[8],
        lambda x: 0.009276937181875763 * max(0, x[10] - 17.54956425423608) * x[8],
        lambda x: 0.002493033956766949 * max(0, 17.54956425423608 - x[10]) * x[8],
        lambda x: -0.2221111637718456 * max(0, x[10] - 14.036059887032016) * x[3],
        lambda x: 0.4135008104273869 * max(0, 14.036059887032016 - x[10]) * x[3],
        lambda x: -0.0008578395557694851 * max(0, x[10] - 16.945375271642703) * x[1],
        lambda x: -0.00023592137985106731 * max(0, 16.945375271642703 - x[10]) * x[1],
        lambda x: 0.0011274258633293677 * x[0] * x[3],
        lambda x: 0.38252564930229016 * max(0, x[9] - 19.427263543436645) * x[3],
        lambda x: 0.03214846955994948 * max(0, 19.427263543436645 - x[9]) * x[3],
        lambda x: -0.001269677855463787 * max(0, x[9] - 19.223362869323164) * x[1],
        lambda x: -0.000244907028536856 * max(0, 19.223362869323164 - x[9]) * x[1],
        lambda x: 0.014319350234790784 * max(0, x[9] - 16.76866294798368) * x[8],
        lambda x: 0.0005156694349395252 * x[8] * x[8],
        lambda x: -0.025347581107362016 * max(0, x[9] - 21.02180710433295) * x[8],
        lambda x: 0.002155280675626814 * max(0, 21.02180710433295 - x[9]) * x[8]]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
