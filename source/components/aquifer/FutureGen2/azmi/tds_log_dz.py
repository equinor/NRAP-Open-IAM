'''
output: tds_log_dz
prediction score: 0.8020067652767044
Forward Pass
---------------------------------------------------------------
iter  parent  var  knot  mse       terms  gcv    rsq    grsq
---------------------------------------------------------------
0     -       -    -     3.256642  1      3.258  0.000  0.000
1     0       1    -1    2.539052  2      2.542  0.220  0.220
2     0       10   4374  1.945415  4      1.952  0.403  0.401
3     3       9    1804  1.432058  6      1.439  0.560  0.558
4     1       10   4449  1.139848  8      1.148  0.650  0.648
5     1       1    -1    1.039947  9      1.048  0.681  0.678
6     1       9    5331  1.006734  11     1.016  0.691  0.688
7     2       9    981   0.944080  13     0.955  0.710  0.707
8     0       3    -1    0.921798  14     0.933  0.717  0.714
9     0       4    -1    0.908336  15     0.921  0.721  0.717
10    2       0    -1    0.894799  16     0.908  0.725  0.721
11    13      9    1340  0.882073  18     0.896  0.729  0.725
12    0       9    1205  0.860193  20     0.876  0.736  0.731
13    19      10   390   0.845138  22     0.862  0.740  0.735
14    2       9    517   0.828798  24     0.847  0.746  0.740
15    13      9    2999  0.816651  26     0.836  0.749  0.743
16    1       10   4519  0.806563  28     0.827  0.752  0.746
17    0       10   3821  0.786578  30     0.808  0.758  0.752
18    28      9    773   0.767624  32     0.790  0.764  0.757
19    0       8    -1    0.756732  33     0.780  0.768  0.761
20    28      9    1948  0.747531  35     0.772  0.770  0.763
21    1       3    -1    0.738049  36     0.763  0.773  0.766
22    18      0    -1    0.730226  37     0.755  0.776  0.768
23    13      4    -1    0.723734  38     0.749  0.778  0.770
24    1       8    -1    0.717516  39     0.744  0.780  0.772
25    28      10   3956  0.712268  41     0.740  0.781  0.773
26    14      10   731   0.708122  43     0.737  0.783  0.774
27    1       10   2838  0.704004  45     0.734  0.784  0.775
28    3       10   1437  0.697180  47     0.728  0.786  0.777
29    19      10   3294  0.692321  49     0.724  0.787  0.778
30    13      9    2745  0.687155  51     0.720  0.789  0.779
31    1       10   1356  0.682790  53     0.717  0.790  0.780
32    0       10   830   0.676310  55     0.712  0.792  0.782
33    54      9    1804  0.672304  57     0.709  0.794  0.782
34    19      10   1278  0.668151  59     0.706  0.795  0.783
35    53      9    517   0.664071  61     0.703  0.796  0.784
36    18      9    4455  0.661349  63     0.701  0.797  0.785
---------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
----------------------------------------------
iter  bf  terms  mse   gcv    rsq     grsq
----------------------------------------------
0     -   63     0.66  0.704  0.796   0.784
1     17  62     0.66  0.703  0.796   0.784
2     13  61     0.66  0.703  0.796   0.784
3     52  60     0.66  0.702  0.796   0.785
4     53  59     0.66  0.701  0.796   0.785
5     3   58     0.66  0.701  0.796   0.785
6     7   57     0.66  0.700  0.796   0.785
7     47  56     0.66  0.699  0.796   0.785
8     58  55     0.66  0.699  0.796   0.786
9     34  54     0.66  0.698  0.796   0.786
10    27  53     0.66  0.697  0.796   0.786
11    2   52     0.66  0.696  0.796   0.786
12    16  51     0.66  0.695  0.796   0.787
13    31  50     0.66  0.694  0.796   0.787
14    43  49     0.66  0.694  0.796   0.787
15    44  48     0.66  0.694  0.796   0.787
16    40  47     0.66  0.694  0.796   0.787
17    28  46     0.66  0.694  0.796   0.787
18    18  45     0.66  0.693  0.796   0.787
19    10  44     0.67  0.693  0.796   0.787
20    55  43     0.67  0.692  0.796   0.788
21    12  42     0.67  0.693  0.795   0.787
22    19  41     0.67  0.693  0.795   0.787
23    21  40     0.67  0.693  0.795   0.787
24    59  39     0.67  0.694  0.794   0.787
25    9   38     0.67  0.695  0.794   0.787
26    42  37     0.67  0.697  0.793   0.786
27    41  36     0.68  0.699  0.792   0.786
28    61  35     0.68  0.701  0.792   0.785
29    62  34     0.68  0.701  0.791   0.785
30    57  33     0.68  0.704  0.790   0.784
31    46  32     0.69  0.708  0.789   0.783
32    45  31     0.69  0.710  0.788   0.782
33    60  30     0.69  0.711  0.787   0.782
34    4   29     0.69  0.713  0.787   0.781
35    23  28     0.70  0.716  0.786   0.780
36    37  27     0.70  0.720  0.784   0.779
37    39  26     0.71  0.725  0.782   0.777
38    38  25     0.71  0.730  0.781   0.776
39    5   24     0.72  0.736  0.779   0.774
40    26  23     0.72  0.738  0.778   0.774
41    56  22     0.72  0.739  0.777   0.773
42    48  21     0.73  0.741  0.777   0.772
43    20  20     0.73  0.743  0.776   0.772
44    22  19     0.73  0.747  0.775   0.771
45    36  18     0.74  0.756  0.771   0.768
46    35  17     0.75  0.766  0.768   0.765
47    32  16     0.77  0.777  0.765   0.762
48    50  15     0.78  0.787  0.761   0.758
49    25  14     0.78  0.791  0.760   0.757
50    14  13     0.80  0.807  0.755   0.752
51    15  12     0.82  0.830  0.748   0.745
52    33  11     0.88  0.885  0.731   0.728
53    24  10     0.89  0.896  0.727   0.725
54    11  9      0.96  0.963  0.707   0.704
55    1   8      1.03  1.042  0.682   0.680
56    8   7      1.04  1.045  0.681   0.679
57    30  6      1.37  1.375  0.580   0.578
58    49  5      1.69  1.694  0.482   0.480
59    29  4      2.39  2.396  0.267   0.265
60    51  3      2.61  2.611  0.200   0.198
61    6   2      2.63  2.635  0.192   0.191
62    54  1      3.26  3.258  -0.000  -0.000
----------------------------------------------
Selected iteration: 20

Earth Model
--------------------------------------------------------------------------
Basis Function                                      Pruned  Coefficient
--------------------------------------------------------------------------
(Intercept)                                         No      -12.3187
depth                                               No      -0.0178905
h(log_brine_mass-11.582)                            Yes     None
h(11.582-log_brine_mass)                            Yes     None
h(log_co2_mass-8.90637)*h(11.582-log_brine_mass)    No      0.0165145
h(8.90637-log_co2_mass)*h(11.582-log_brine_mass)    No      0.182794
h(log_brine_mass-7.26849)*depth                     No      0.00162651
h(7.26849-log_brine_mass)*depth                     Yes     None
depth*depth                                         No      -5.29175e-06
h(log_co2_mass-13.5877)*depth                       No      -7.30503e-05
h(13.5877-log_co2_mass)*depth                       Yes     None
h(log_co2_mass-13.1094)*h(log_brine_mass-11.582)    No      0.0991923
h(13.1094-log_co2_mass)*h(log_brine_mass-11.582)    No      -0.0286565
log_permh                                           Yes     None
log_aniso                                           No      1.52912
thick*h(log_brine_mass-11.582)                      No      0.0011818
h(log_co2_mass-19.3925)*log_permh                   Yes     None
h(19.3925-log_co2_mass)*log_permh                   Yes     None
h(log_co2_mass-15.1012)                             Yes     None
h(15.1012-log_co2_mass)                             No      -0.277195
h(log_brine_mass-6.56654)*h(15.1012-log_co2_mass)   No      0.068814
h(6.56654-log_brine_mass)*h(15.1012-log_co2_mass)   No      -0.0496884
h(log_co2_mass-18.1377)*h(log_brine_mass-11.582)    No      -0.36402
h(18.1377-log_co2_mass)*h(log_brine_mass-11.582)    No      -0.145165
h(log_co2_mass-17.6888)*log_permh                   No      0.413674
h(17.6888-log_co2_mass)*log_permh                   No      -0.283251
h(log_brine_mass-12.2553)*depth                     No      0.000925569
h(12.2553-log_brine_mass)*depth                     Yes     None
h(log_brine_mass-7.3602)                            Yes     None
h(7.3602-log_brine_mass)                            No      3.32443
h(log_co2_mass-14.0677)*h(log_brine_mass-7.3602)    No      -0.140616
h(14.0677-log_co2_mass)*h(log_brine_mass-7.3602)    Yes     None
time                                                No      -0.0188207
h(log_co2_mass-17.6537)*h(log_brine_mass-7.3602)    No      0.115423
h(17.6537-log_co2_mass)*h(log_brine_mass-7.3602)    Yes     None
log_permh*depth                                     No      -0.000486774
thick*h(log_co2_mass-15.1012)                       No      0.00248615
log_aniso*log_permh                                 No      0.100896
time*depth                                          No      -1.18823e-05
h(log_brine_mass-17.477)*h(log_brine_mass-7.3602)   No      0.0165093
h(17.477-log_brine_mass)*h(log_brine_mass-7.3602)   Yes     None
h(log_brine_mass-18.058)*log_aniso                  No      -0.0560228
h(18.058-log_brine_mass)*log_aniso                  No      -0.0103212
h(log_brine_mass-11.8216)*depth                     Yes     None
h(11.8216-log_brine_mass)*depth                     Yes     None
h(log_brine_mass-4.17788)*h(11.582-log_brine_mass)  No      0.163156
h(4.17788-log_brine_mass)*h(11.582-log_brine_mass)  No      -0.0533596
h(log_brine_mass-12.7344)*h(15.1012-log_co2_mass)   Yes     None
h(12.7344-log_brine_mass)*h(15.1012-log_co2_mass)   No      0.0925495
h(log_co2_mass-14.1537)*log_permh                   No      -0.360584
h(14.1537-log_co2_mass)*log_permh                   No      0.304101
h(log_brine_mass-10.6505)*depth                     No      -0.00242638
h(10.6505-log_brine_mass)*depth                     Yes     None
h(log_brine_mass-10.59)                             Yes     None
h(10.59-log_brine_mass)                             No      -2.86564
h(log_co2_mass-8.90637)*h(10.59-log_brine_mass)     Yes     None
h(8.90637-log_co2_mass)*h(10.59-log_brine_mass)     No      -0.232918
h(log_brine_mass-18.7543)*h(15.1012-log_co2_mass)   No      -0.0203058
h(18.7543-log_brine_mass)*h(15.1012-log_co2_mass)   Yes     None
h(log_co2_mass-18.1377)*h(log_brine_mass-10.59)     No      0.269931
h(18.1377-log_co2_mass)*h(log_brine_mass-10.59)     No      0.12123
h(log_co2_mass-19.7069)*h(log_co2_mass-15.1012)     No      0.0433016
h(19.7069-log_co2_mass)*h(log_co2_mass-15.1012)     No      -0.163508
--------------------------------------------------------------------------
MSE: 0.6654, GCV: 0.6922, RSQ: 0.7957, GRSQ: 0.7875
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: -12.318695121786154,
        lambda x: -0.017890489074846982 * x[1],
        lambda x: 0.016514502164332305 * max(0, x[9] - 8.9063728288545) *\
            max(0, 11.582000641026282 - x[10]),
        lambda x: 0.1827937394103333 * max(0, 8.9063728288545 - x[9]) *\
            max(0, 11.582000641026282 - x[10]),
        lambda x: 0.0016265115785019195 * max(0, x[10] - 7.268485110308971) * x[1],
        lambda x: -5.291745076029669e-06 * x[1] * x[1],
        lambda x: -7.305030588884979e-05 * max(0, x[9] - 13.587724912689453) * x[1],
        lambda x: 0.09919228510952166 * max(0, x[9] - 13.10944446246495) *\
            max(0, x[10] - 11.582000641026282),
        lambda x: -0.028656508511838815 * max(0, 13.10944446246495 - x[9]) *\
            max(0, x[10] - 11.582000641026282),
        lambda x: 1.5291179065824734 * x[4],
        lambda x: 0.0011818035085935851 * x[0] * max(0, x[10] - 11.582000641026282),
        lambda x: -0.2771951362720238 * max(0, 15.101183815844534 - x[9]),
        lambda x: 0.06881396573278391 * max(0, x[10] - 6.566538014312585) *\
            max(0, 15.101183815844534 - x[9]),
        lambda x: -0.04968844065670861 * max(0, 6.566538014312585 - x[10]) *\
            max(0, 15.101183815844534 - x[9]),
        lambda x: -0.3640203039734057 * max(0, x[9] - 18.137719443938426) *\
            max(0, x[10] - 11.582000641026282),
        lambda x: -0.14516542995989373 * max(0, 18.137719443938426 - x[9]) *\
            max(0, x[10] - 11.582000641026282),
        lambda x: 0.41367416673564983 * max(0, x[9] - 17.68876492756577) * x[3],
        lambda x: -0.2832511769026207 * max(0, 17.68876492756577 - x[9]) * x[3],
        lambda x: 0.0009255692278010542 * max(0, x[10] - 12.255316184421266) * x[1],
        lambda x: 3.3244323738617463 * max(0, 7.360204139308023 - x[10]),
        lambda x: -0.14061642590922907 * max(0, x[9] - 14.067661087854034) *\
            max(0, x[10] - 7.360204139308023),
        lambda x: -0.018820740879935176 * x[8],
        lambda x: 0.11542250551687946 * max(0, x[9] - 17.653738988253426) *\
            max(0, x[10] - 7.360204139308023),
        lambda x: -0.00048677411112532534 * x[3] * x[1],
        lambda x: 0.002486154325306747 * x[0] * max(0, x[9] - 15.101183815844534),
        lambda x: 0.100895615186491 * x[4] * x[3],
        lambda x: -1.1882274251519178e-05 * x[8] * x[1],
        lambda x: 0.01650930702615344 * max(0, x[10] - 17.47696212475013) *\
            max(0, x[10] - 7.360204139308023),
        lambda x: -0.05602284137499205 * max(0, x[10] - 18.05798561428363) * x[4],
        lambda x: -0.010321201371157291 * max(0, 18.05798561428363 - x[10]) * x[4],
        lambda x: 0.16315596575090918 * max(0, x[10] - 4.177884362484675) *\
            max(0, 11.582000641026282 - x[10]),
        lambda x: -0.05335964032780202 * max(0, 4.177884362484675 - x[10]) *\
            max(0, 11.582000641026282 - x[10]),
        lambda x: 0.09254953949734603 * max(0, 12.734390750077242 - x[10]) *\
            max(0, 15.101183815844534 - x[9]),
        lambda x: -0.36058365117163343 * max(0, x[9] - 14.153722130090252) * x[3],
        lambda x: 0.3041007820593871 * max(0, 14.153722130090252 - x[9]) * x[3],
        lambda x: -0.0024263763858946162 * max(0, x[10] - 10.65047514143649) * x[1],
        lambda x: -2.8656424981397515 * max(0, 10.589959868429036 - x[10]),
        lambda x: -0.2329181510780731 * max(0, 8.9063728288545 - x[9]) *\
            max(0, 10.589959868429036 - x[10]),
        lambda x: -0.020305798915818542 * max(0, x[10] - 18.754308361109686) *\
            max(0, 15.101183815844534 - x[9]),
        lambda x: 0.26993118919800557 * max(0, x[9] - 18.137719443938426) *\
            max(0, x[10] - 10.589959868429036),
        lambda x: 0.12123000613094553 * max(0, 18.137719443938426 - x[9]) *\
            max(0, x[10] - 10.589959868429036),
        lambda x: 0.04330155387134757 * max(0, x[9] - 19.70689927950347) *\
            max(0, x[9] - 15.101183815844534),
        lambda x: -0.16350794336205732 * max(0, 19.70689927950347 - x[9]) *\
            max(0, x[9] - 15.101183815844534)]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
