'''
output: tds_log_vol
prediction score: 0.8523739443016571
Forward Pass
-----------------------------------------------------------------
iter  parent  var  knot  mse        terms  gcv     rsq    grsq
-----------------------------------------------------------------
0     -       -    -     45.779980  1      45.797  0.000  0.000
1     0       10   1716  27.348580  3      27.409  0.403  0.402
2     1       1    -1    13.073309  4      13.114  0.714  0.714
3     0       9    3428  10.824333  6      10.879  0.764  0.762
4     1       9    3386  8.465083   8      8.523   0.815  0.814
5     4       2    240   8.271746   10     8.344   0.819  0.818
6     0       1    404   8.205791   12     8.293   0.821  0.819
7     11      1    -1    7.045046   13     7.126   0.846  0.844
8     4       10   4574  6.982230   15     7.076   0.847  0.845
9     11      10   292   6.923212   17     7.029   0.849  0.847
10    11      10   1490  6.878918   19     6.997   0.850  0.847
-----------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
------------------------------------------------
iter  bf  terms  mse    gcv     rsq     grsq
------------------------------------------------
0     -   19     6.88   6.997   0.850   0.847
1     15  18     6.88   6.991   0.850   0.847
2     5   17     6.88   6.985   0.850   0.847
3     13  16     6.88   6.979   0.850   0.848
4     10  15     6.88   6.976   0.850   0.848
5     7   14     6.89   6.973   0.850   0.848
6     8   13     6.90   6.980   0.849   0.848
7     4   12     6.93   7.007   0.849   0.847
8     17  11     6.98   7.049   0.848   0.846
9     16  10     6.98   7.045   0.847   0.846
10    18  9      7.04   7.098   0.846   0.845
11    2   8      7.13   7.181   0.844   0.843
12    6   7      7.34   7.380   0.840   0.839
13    9   6      7.40   7.435   0.838   0.838
14    11  5      8.48   8.511   0.815   0.814
15    12  4      8.66   8.689   0.811   0.810
16    14  3      13.25  13.279  0.711   0.710
17    3   2      27.48  27.519  0.400   0.399
18    1   1      45.78  45.797  -0.000  -0.000
------------------------------------------------
Selected iteration: 5

Earth Model
------------------------------------------------------------------------
Basis Function                                     Pruned  Coefficient
------------------------------------------------------------------------
(Intercept)                                        No      -0.848647
h(log_brine_mass-6.93715)                          No      2.46281
h(6.93715-log_brine_mass)                          No      -0.312367
depth*h(log_brine_mass-6.93715)                    No      0.00128985
h(log_co2_mass-13.479)                             No      0.405385
h(13.479-log_co2_mass)                             Yes     None
h(log_co2_mass-12.6424)*h(log_brine_mass-6.93715)  No      -0.048241
h(12.6424-log_co2_mass)*h(log_brine_mass-6.93715)  Yes     None
h(por-0.199557)*h(log_co2_mass-13.479)             No      1909.28
h(0.199557-por)*h(log_co2_mass-13.479)             No      2.3678
h(depth+702.833)                                   Yes     None
h(-702.833-depth)                                  No      0.0345287
depth*h(-702.833-depth)                            No      1.83662e-05
h(log_brine_mass-19.1399)*h(log_co2_mass-13.479)   Yes     None
h(19.1399-log_brine_mass)*h(log_co2_mass-13.479)   No      0.0366268
h(log_brine_mass-23.6736)*h(-702.833-depth)        Yes     None
h(23.6736-log_brine_mass)*h(-702.833-depth)        No      -0.0119517
h(log_brine_mass-22.5364)*h(-702.833-depth)        No      -0.00865658
h(22.5364-log_brine_mass)*h(-702.833-depth)        No      0.0123596
------------------------------------------------------------------------
MSE: 6.8869, GCV: 6.9729, RSQ: 0.8496, GRSQ: 0.8477
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: -0.8486469603018469,
        lambda x: 2.4628145715810765 * max(0, x[10] - 6.9371532496084),
        lambda x: -0.31236734165094426 * max(0, 6.9371532496084 - x[10]),
        lambda x: 0.0012898539129567108 * x[1] * max(0, x[10] - 6.9371532496084),
        lambda x: 0.40538498737780226 * max(0, x[9] - 13.47900713122062),
        lambda x: -0.04824095405771963 * max(0, x[9] - 12.64244478092122) *\
            max(0, x[10] - 6.9371532496084),
        lambda x: 1909.2800704406839 * max(0, x[2] - 0.1995572603199634) *\
            max(0, x[9] - 13.47900713122062),
        lambda x: 2.367803542997856 * max(0, 0.1995572603199634 - x[2]) *\
            max(0, x[9] - 13.47900713122062),
        lambda x: 0.034528664972267406 * max(0, -702.8333268275682 - x[1]),
        lambda x: 1.836624738782433e-05 * x[1] * max(0, -702.8333268275682 - x[1]),
        lambda x: 0.03662680543729898 * max(0, 19.139923026463258 - x[10]) *\
            max(0, x[9] - 13.47900713122062),
        lambda x: -0.011951682502939924 * max(0, 23.673615203756253 - x[10]) *\
            max(0, -702.8333268275682 - x[1]),
        lambda x: -0.008656576501293537 * max(0, x[10] - 22.536443700926455) *\
            max(0, -702.8333268275682 - x[1]),
        lambda x: 0.012359649122477605 * max(0, 22.536443700926455 - x[10]) *\
            max(0, -702.8333268275682 - x[1])]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
