'''
output: ph_log_vol
prediction score: 0.8581151787229434
Forward Pass
-----------------------------------------------------------------
iter  parent  var  knot  mse        terms  gcv     rsq    grsq
-----------------------------------------------------------------
0     -       -    -     46.499572  1      46.517  0.000  0.000
1     0       9    4163  10.356594  3      10.380  0.777  0.777
2     0       10   928   9.031340   5      9.068   0.806  0.805
3     4       9    4752  7.548381   7      7.593   0.838  0.837
4     0       2    -1    7.340248   8      7.391   0.842  0.841
5     3       0    -1    7.145541   9      7.201   0.846  0.845
6     1       10   257   6.991328   11     7.059   0.850  0.848
7     3       10   530   6.854701   13     6.934   0.853  0.851
8     3       4    -1    6.743886   14     6.828   0.855  0.853
9     0       3    -1    6.646754   15     6.736   0.857  0.855
10    4       9    4572  6.562813   17     6.663   0.859  0.857
11    14      9    2113  6.395557   19     6.506   0.862  0.860
12    14      3    -1    6.328220   20     6.443   0.864  0.861
13    1       10   4311  6.260044   22     6.386   0.865  0.863
14    3       10   1801  6.139907   24     6.275   0.868  0.865
15    14      10   292   6.001286   26     6.145   0.871  0.868
16    0       8    -1    5.939619   27     6.087   0.872  0.869
17    26      4    -1    5.883272   28     6.035   0.873  0.870
18    4       9    1392  5.847201   30     6.009   0.874  0.871
-----------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
------------------------------------------------
iter  bf  terms  mse    gcv     rsq     grsq
------------------------------------------------
0     -   30     5.85   6.012   0.874   0.871
1     28  29     5.85   6.006   0.874   0.871
2     1   28     5.85   6.000   0.874   0.871
3     23  27     5.85   5.995   0.874   0.871
4     4   26     5.85   5.989   0.874   0.871
5     18  25     5.85   5.984   0.874   0.871
6     2   24     5.85   5.979   0.874   0.871
7     25  23     5.86   5.979   0.874   0.871
8     12  22     5.87   5.985   0.874   0.871
9     29  21     5.90   6.014   0.873   0.871
10    14  20     5.95   6.060   0.872   0.870
11    27  19     6.01   6.113   0.871   0.869
12    15  18     6.07   6.164   0.870   0.867
13    26  17     6.13   6.225   0.868   0.866
14    19  16     6.20   6.290   0.867   0.865
15    3   15     6.28   6.362   0.865   0.863
16    13  14     6.31   6.394   0.864   0.863
17    5   13     6.44   6.516   0.861   0.860
18    11  12     6.57   6.640   0.859   0.857
19    24  11     6.65   6.718   0.857   0.856
20    17  10     6.82   6.878   0.853   0.852
21    22  9      6.99   7.042   0.850   0.849
22    20  8      7.04   7.087   0.849   0.848
23    7   7      7.26   7.306   0.844   0.843
24    8   6      8.00   8.043   0.828   0.827
25    16  5      10.39  10.433  0.777   0.776
26    6   4      10.81  10.843  0.768   0.767
27    9   3      14.82  14.852  0.681   0.681
28    10  2      28.94  28.981  0.378   0.377
29    21  1      46.50  46.517  -0.000  -0.000
------------------------------------------------
Selected iteration: 7

Earth Model
--------------------------------------------------------------------------
Basis Function                                       Pruned  Coefficient
--------------------------------------------------------------------------
(Intercept)                                          No      -49.1391
h(log_co2_mass-1.56708)                              Yes     None
h(1.56708-log_co2_mass)                              Yes     None
h(log_brine_mass-17.5454)                            No      -0.751144
h(17.5454-log_brine_mass)                            Yes     None
h(log_co2_mass-1.71908)*h(17.5454-log_brine_mass)    No      0.108309
h(1.71908-log_co2_mass)*h(17.5454-log_brine_mass)    No      -0.262349
por                                                  No      -9.67426
thick*h(log_brine_mass-17.5454)                      No      -0.0144821
h(log_brine_mass-19.8846)*h(log_co2_mass-1.56708)    No      0.353786
h(19.8846-log_brine_mass)*h(log_co2_mass-1.56708)    No      -0.448457
h(log_brine_mass-24.5274)*h(log_brine_mass-17.5454)  No      -5.18987
h(24.5274-log_brine_mass)*h(log_brine_mass-17.5454)  No      -0.0953674
log_aniso*h(log_brine_mass-17.5454)                  No      0.259897
log_permh                                            No      -8.56097
h(log_co2_mass-14.0914)*h(17.5454-log_brine_mass)    No      0.032461
h(14.0914-log_co2_mass)*h(17.5454-log_brine_mass)    No      0.0403805
h(log_co2_mass-15.2579)*log_permh                    No      0.0378838
h(15.2579-log_co2_mass)*log_permh                    Yes     None
log_permh*log_permh                                  No      -0.355185
h(log_brine_mass-23.8856)*h(log_co2_mass-1.56708)    No      -2.17885
h(23.8856-log_brine_mass)*h(log_co2_mass-1.56708)    No      0.328961
h(log_brine_mass-23.6367)*h(log_brine_mass-17.5454)  No      12.8447
h(23.6367-log_brine_mass)*h(log_brine_mass-17.5454)  Yes     None
h(log_brine_mass-23.6736)*log_permh                  No      6.4544
h(23.6736-log_brine_mass)*log_permh                  Yes     None
time                                                 No      0.0241861
log_aniso*time                                       No      -0.00840312
h(log_co2_mass-5.22977)*h(17.5454-log_brine_mass)    Yes     None
h(5.22977-log_co2_mass)*h(17.5454-log_brine_mass)    No      -0.0356533
--------------------------------------------------------------------------
MSE: 5.8560, GCV: 5.9791, RSQ: 0.8741, GRSQ: 0.8715
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: -49.13913020077544,
        lambda x: -0.7511435727143299 * max(0, x[10] - 17.545437141980507),
        lambda x: 0.10830865371486008 * max(0, x[9] - 1.7190787874196276) *\
            max(0, 17.545437141980507 - x[10]),
        lambda x: -0.26234858555241625 * max(0, 1.7190787874196276 - x[9]) *\
            max(0, 17.545437141980507 - x[10]),
        lambda x: -9.674258737968694 * x[2],
        lambda x: -0.01448213585600848 * x[0] * max(0, x[10] - 17.545437141980507),
        lambda x: 0.353786318325265 * max(0, x[10] - 19.88460920076891) *\
            max(0, x[9] - 1.5670808816696813),
        lambda x: -0.4484568977997884 * max(0, 19.88460920076891 - x[10]) *\
            max(0, x[9] - 1.5670808816696813),
        lambda x: -5.189866117507518 * max(0, x[10] - 24.52738154311614) *\
            max(0, x[10] - 17.545437141980507),
        lambda x: -0.09536743674034068 * max(0, 24.52738154311614 - x[10]) *\
            max(0, x[10] - 17.545437141980507),
        lambda x: 0.2598965675486804 * x[4] * max(0, x[10] - 17.545437141980507),
        lambda x: -8.560974808821175 * x[3],
        lambda x: 0.03246102483479741 * max(0, x[9] - 14.091373443742283) *\
            max(0, 17.545437141980507 - x[10]),
        lambda x: 0.04038052371078073 * max(0, 14.091373443742283 - x[9]) *\
            max(0, 17.545437141980507 - x[10]),
        lambda x: 0.03788378884629132 * max(0, x[9] - 15.257910564867954) * x[3],
        lambda x: -0.35518471772847 * x[3] * x[3],
        lambda x: -2.1788460748274887 * max(0, x[10] - 23.8856148214934) *\
            max(0, x[9] - 1.5670808816696813),
        lambda x: 0.32896067648252786 * max(0, 23.8856148214934 - x[10]) *\
            max(0, x[9] - 1.5670808816696813),
        lambda x: 12.844666648428564 * max(0, x[10] - 23.63667217603707) *\
            max(0, x[10] - 17.545437141980507),
        lambda x: 6.454399484721951 * max(0, x[10] - 23.673615203756253) * x[3],
        lambda x: 0.024186069629292026 * x[8],
        lambda x: -0.008403115125550975 * x[4] * x[8],
        lambda x: -0.035653328595226186 * max(0, 5.229767016143418 - x[9]) *\
            max(0, 17.545437141980507 - x[10])]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
