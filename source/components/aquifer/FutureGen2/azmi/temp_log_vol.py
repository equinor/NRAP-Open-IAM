'''
output: temp_log_vol
prediction score: 0.93359281229293
Forward Pass
-----------------------------------------------------------------
iter  parent  var  knot  mse        terms  gcv     rsq    grsq
-----------------------------------------------------------------
0     -       -    -     48.142106  1      48.160  0.000  0.000
1     0       9    2903  21.124078  3      21.171  0.561  0.560
2     0       10   3371  11.499862  5      11.547  0.761  0.760
3     3       9    925   4.987686   7      5.017   0.896  0.896
4     1       9    3704  4.205172   9      4.238   0.913  0.912
5     0       8    -1    3.883845   10     3.918   0.919  0.919
6     3       9    1490  3.597883   12     3.636   0.925  0.925
7     9       9    845   3.470031   14     3.513   0.928  0.927
8     9       9    859   3.355826   16     3.404   0.930  0.929
9     3       10   2730  3.253469   18     3.306   0.932  0.931
10    1       10   3705  3.146784   20     3.204   0.935  0.933
11    9       0    -1    3.064162   21     3.123   0.936  0.935
12    1       10   3200  2.993310   23     3.056   0.938  0.937
13    3       3    -1    2.956915   24     3.022   0.939  0.937
-----------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
----------------------------------------------
iter  bf  terms  mse    gcv     rsq    grsq
----------------------------------------------
0     -   24     2.96   3.023   0.939  0.937
1     22  23     2.96   3.020   0.939  0.937
2     15  22     2.96   3.017   0.939  0.937
3     5   21     2.96   3.014   0.939  0.937
4     19  20     2.96   3.012   0.939  0.937
5     3   19     2.96   3.009   0.939  0.938
6     4   18     2.96   3.008   0.939  0.938
7     7   17     2.97   3.016   0.938  0.937
8     2   16     2.98   3.020   0.938  0.937
9     16  15     3.00   3.042   0.938  0.937
10    10  14     3.07   3.106   0.936  0.936
11    23  13     3.13   3.166   0.935  0.934
12    21  12     3.18   3.211   0.934  0.933
13    18  11     3.21   3.244   0.933  0.933
14    20  10     3.30   3.324   0.932  0.931
15    17  9      3.41   3.439   0.929  0.929
16    13  8      3.57   3.590   0.926  0.925
17    14  7      3.62   3.642   0.925  0.924
18    12  6      3.72   3.735   0.923  0.922
19    11  5      4.05   4.070   0.916  0.915
20    9   4      4.39   4.401   0.909  0.909
21    8   3      5.75   5.760   0.881  0.880
22    6   2      21.92  21.944  0.545  0.544
23    1   1      48.14  48.160  0.000  0.000
----------------------------------------------
Selected iteration: 6

Earth Model
--------------------------------------------------------------------------
Basis Function                                       Pruned  Coefficient
--------------------------------------------------------------------------
(Intercept)                                          No      0.852457
h(log_co2_mass-0.0355183)                            No      0.840917
h(0.0355183-log_co2_mass)                            No      -23.9989
h(log_brine_mass-6.70555)                            Yes     None
h(6.70555-log_brine_mass)                            Yes     None
h(log_co2_mass-15.8453)*h(log_brine_mass-6.70555)    Yes     None
h(15.8453-log_co2_mass)*h(log_brine_mass-6.70555)    No      0.097608
h(log_co2_mass-11.1375)*h(log_co2_mass-0.0355183)    No      0.00567163
h(11.1375-log_co2_mass)*h(log_co2_mass-0.0355183)    No      -0.0954827
time                                                 No      -0.0998045
h(log_co2_mass-3.84866)*h(log_brine_mass-6.70555)    No      0.0555655
h(3.84866-log_co2_mass)*h(log_brine_mass-6.70555)    No      -0.199786
h(log_co2_mass-7.66376)*time                         No      0.0146099
h(7.66376-log_co2_mass)*time                         No      0.00772942
h(log_co2_mass-12.4674)*time                         No      -0.0166838
h(12.4674-log_co2_mass)*time                         Yes     None
h(log_brine_mass-13.6023)*h(log_brine_mass-6.70555)  No      -0.0107638
h(13.6023-log_brine_mass)*h(log_brine_mass-6.70555)  No      -0.207971
h(log_brine_mass-16.6917)*h(log_co2_mass-0.0355183)  No      0.0559043
h(16.6917-log_brine_mass)*h(log_co2_mass-0.0355183)  Yes     None
thick*time                                           No      0.000426259
h(log_brine_mass-8.78731)*h(log_co2_mass-0.0355183)  No      -0.0884259
h(8.78731-log_brine_mass)*h(log_co2_mass-0.0355183)  Yes     None
log_permh*h(log_brine_mass-6.70555)                  No      -0.0307547
--------------------------------------------------------------------------
MSE: 2.9594, GCV: 3.0076, RSQ: 0.9385, GRSQ: 0.9376
parameters:
X[ 0 ] =  thick
X[ 1 ] =  depth
X[ 2 ] =  por
X[ 3 ] =  log_permh
X[ 4 ] =  log_aniso
X[ 5 ] =  rel_vol_frac_calcite
X[ 6 ] =  log_co2_rate
X[ 7 ] =  log_brine_rate
X[ 8 ] =  time
X[ 9 ] =  log_co2_mass
X[ 10 ] =  log_brine_mass
'''
def model(example_iterator):
    accessors = [
        lambda x: 0.8524568697674939,
        lambda x: 0.8409165870973329 * max(0, x[9] - 0.035518327419905155),
        lambda x: -23.998912643293544 * max(0, 0.035518327419905155 - x[9]),
        lambda x: 0.09760797206991223 * max(0, 15.845314774707775 - x[9]) *\
            max(0, x[10] - 6.70554608920821),
        lambda x: 0.005671631429920117 * max(0, x[9] - 11.137548349489224) *\
            max(0, x[9] - 0.035518327419905155),
        lambda x: -0.09548271465819373 * max(0, 11.137548349489224 - x[9]) *\
            max(0, x[9] - 0.035518327419905155),
        lambda x: -0.09980448834039674 * x[8],
        lambda x: 0.055565498253678666 * max(0, x[9] - 3.8486582885509946) *\
            max(0, x[10] - 6.70554608920821),
        lambda x: -0.19978556021059868 * max(0, 3.8486582885509946 - x[9]) *\
            max(0, x[10] - 6.70554608920821),
        lambda x: 0.014609903267449001 * max(0, x[9] - 7.663758738132531) * x[8],
        lambda x: 0.007729419775816374 * max(0, 7.663758738132531 - x[9]) * x[8],
        lambda x: -0.0166837598828304 * max(0, x[9] - 12.467408669615557) * x[8],
        lambda x: -0.010763754369056544 * max(0, x[10] - 13.602291571586962) *\
            max(0, x[10] - 6.70554608920821),
        lambda x: -0.20797124022095806 * max(0, 13.602291571586962 - x[10]) *\
            max(0, x[10] - 6.70554608920821),
        lambda x: 0.055904311316595935 * max(0, x[10] - 16.691745655826043) *\
            max(0, x[9] - 0.035518327419905155),
        lambda x: 0.0004262592468240456 * x[0] * x[8],
        lambda x: -0.0884259274058292 * max(0, x[10] - 8.787314982847542) *\
            max(0, x[9] - 0.035518327419905155),
        lambda x: -0.030754689374837232 * x[3] * max(0, x[10] - 6.70554608920821)]
    for x in example_iterator:
        yield sum(accessor(x) for accessor in accessors)
